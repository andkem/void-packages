# Template file for 'siril'
pkgname=siril
version=0.99.10
revision=1
wrksrc="${pkgname}"
build_style=gnu-configure
hostmakedepends="pkg-config intltool autoconf automake gettext-devel"
makedepends="glib-devel json-glib-devel exiv2-devel gtk+3-devel
 cairo-devel fftw-devel gsl-devel cfitsio-devel libconfig-devel
 libopencv4-devel librtprocess-devel libraw-devel tiff-devel
 libjpeg-turbo-devel libpng-devel libheif-devel libffms2-devel
 ffmpeg-devel libcurl-devel wcslib-devel libgomp-devel"
depends="gnuplot"
short_desc="Free astronomical image processing software"
maintainer="Andreas Kempe <kempe@lysator.liu.se>"
license="GPL-3.0-or-later"
homepage="https://www.siril.org/"
distfiles="https://free-astro.org/download/${pkgname}-${version}.tar.bz2"
checksum=37e8f430499946b2543dceef08f5632d80f8302440b2b398813f617794c2e840
# make check doesn't really do anything and is broken.
make_check=no
patch_args="-p1"

if [ "$XBPS_TARGET_NO_ATOMIC8" ]; then
	makedepends+=" libatomic-devel"
fi

if [ "$XBPS_TARGET_LIBC" = "musl" ]; then
	makedepends+=" libexecinfo-devel"
fi

CFLAGS="-fcommon"

pre_configure() {
	NOCONFIGURE=1 ./autogen.sh
}
